---
up:
  - "[[Spring6 課程描述]]"
---
# **① 介绍**

> 事务属性中的回滚策略指的是当事务出现异常时，应该如何处理事务的提交或回滚

### 属性分类：

rollbackFor属性：当事务方法抛出指定类型的异常时，事务会回滚

```java
@Transactional(rollbackFor = {SQLException.class, IOException.class})
```

rollbackForClassName属性：与rollbackFor属性相似，但是指定异常类型时使用字符串的方式

```java
@Transactional(rollbackForClassName = {"java.sql.SQLException", "java.io.IOException"})
```

noRollbackFor属性：指定当事务方法抛出指定类型的异常时，事务不回滚。

```java
@Transactional(noRollbackFor = {NullPointerException.class, IllegalArgumentException.class})
```

noRollbackForClassName属性：与noRollbackFor属性相似，但是指定异常类型时使用字符串的方式

```java
@Transactional(noRollbackForClassName = {"java.lang.NullPointerException", "java.lang.IllegalArgumentException"})
```

---

# **② 使用方式**

```java
@Transactional(noRollbackFor = ArithmeticException.class)
//@Transactional(noRollbackForClassName = "java.lang.ArithmeticException")
public void buyBook(Integer bookId, Integer userId) {
    //查询图书的价格
    Integer price = bookDao.getPriceByBookId(bookId);
    //更新图书的库存
    bookDao.updateStock(bookId);
    //更新用户的余额
    bookDao.updateBalance(userId, price);
    System.out.println(1/0);
}
```

---

# **③ 观察结果**

虽然购买图书功能中出现了数学运算异常（ArithmeticException），但是我们设置的回滚策略是，当出现ArithmeticException不发生回滚，因此购买图书的操作正常执行

---