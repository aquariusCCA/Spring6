---
up:
  - "[[Spring6 課程描述]]"
---
# 概述

**Log4j2** 是一个开源的Java日志框架，是Log4j的升级版。它可以帮助Java开发人员在应用程序中实现灵活和可配置的日志记录，支持异步日志记录、多线程安全等特性

--- 

# 组成

**日志信息的优先级：** 日志信息的优先级从高到低有 TRACE < DEBUG < INFO < WARN < ERROR < FATAL

> [!NOTE] 说明：
> 
> - TRACE：追踪，是最低的日志级别，相当于追踪程序的执行
> - DEBUG：调试，一般在开发中，都将其设置为最低的日志级别
> - INFO：信息，输出重要的信息，使用较多
> - WARN：警告，输出警告的信息
> - ERROR：错误，输出错误信息
> - FATAL：严重错误

**日志信息的输出目的地：** 日志信息的输出目的地指定了日志将打印到控制台还是文件中；

**日志信息的输出格式：** 而输出格式则控制了日志信息的显示内容。

---

# 基本用例-Log4j2基本使用

### 步骤一：引入Log4j2依赖

修改模块中的`pom.xml`文件

```xml
<!--log4j2的依赖-->
<dependency>
    <groupId>org.apache.logging.log4j</groupId>
    <artifactId>log4j-core</artifactId>
    <version>2.19.0</version>
</dependency>
<dependency>
    <groupId>org.apache.logging.log4j</groupId>
    <artifactId>log4j-slf4j2-impl</artifactId>
    <version>2.19.0</version>
</dependency>
```

>  log4j 的 Maven 使用光有核心 core 依赖不够，还需要有实现 impl 依赖

### 步骤二：创建日志配置文件

在模块文件路径在 resource 的根路径下，配置文件名为 **log4j2.xml**

```xml
<?xml version="1.0" encoding="UTF-8"?>
<configuration>
    <loggers>
        <!--
            level指定日志级别，从低到高的优先级：
                TRACE < DEBUG < INFO < WARN < ERROR < FATAL
                trace：追踪，是最低的日志级别，相当于追踪程序的执行
                debug：调试，一般在开发中，都将其设置为最低的日志级别
                info：信息，输出重要的信息，使用较多
                warn：警告，输出警告的信息
                error：错误，输出错误信息
                fatal：严重错误
        -->
        <root level="DEBUG">
            <appender-ref ref="spring6log"/>
            <appender-ref ref="RollingFile"/>
            <appender-ref ref="log"/>
        </root>
    </loggers>

    <appenders>
        <!--输出日志信息到控制台-->
        <console name="spring6log" target="SYSTEM_OUT">
            <!--控制日志输出的格式-->
            <PatternLayout pattern="%d{yyyy-MM-dd HH:mm:ss SSS} [%t] %-3level %logger{1024} - %msg%n"/>
        </console>

        <!--文件会打印出所有信息，这个log每次运行程序会自动清空，由append属性决定，适合临时测试用-->
        <File name="log" fileName="d:/spring6_log/test.log" append="false">
            <PatternLayout pattern="%d{HH:mm:ss.SSS} %-5level %class{36} %L %M - %msg%xEx%n"/>
        </File>

        <!-- 这个会打印出所有的信息，
            每次大小超过size，
            则这size大小的日志会自动存入按年份-月份建立的文件夹下面并进行压缩，
            作为存档-->
        <RollingFile name="RollingFile" fileName="d:/spring6_log/app.log"
                     filePattern="log/$${date:yyyy-MM}/app-%d{MM-dd-yyyy}-%i.log.gz">
            <PatternLayout pattern="%d{yyyy-MM-dd 'at' HH:mm:ss z} %-5level %class{36} %L %M - %msg%xEx%n"/>
            <SizeBasedTriggeringPolicy size="50MB"/>
            <!-- DefaultRolloverStrategy属性如不设置，
            则默认为最多同一文件夹下7个文件，这里设置了20 -->
            <DefaultRolloverStrategy max="20"/>
        </RollingFile>
    </appenders>
</configuration>
```

### 步骤三：日常使用

在日常中，只用log4j2，此处创建HelloWorldTest使用

```java
public class HelloWorldTest {

    // 1.通过日志工程获取日志对象记录器
    private Logger logger = LoggerFactory.getLogger(HelloWorldTest.class);
 
    @Test
    public void testHelloWorld(){
        ApplicationContext ac = new ClassPathXmlApplicationContext("beans.xml");
        HelloWorld helloworld = (HelloWorld) ac.getBean("helloWorld");
        helloworld.sayHello();
        // 2.记录日志
        logger.info("执行成功");
    }
}
```

### 步骤四：演示

![[0ae46c93d27d4f11c9685742a3cde09e.png]]

> 当完成以上步骤后，运行，日志就会输出在控制台

---
